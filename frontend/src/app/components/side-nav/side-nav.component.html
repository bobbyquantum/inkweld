<div class="side-nav-container" [class.mobile]="isMobile">
  <nav class="side-nav" [class.collapsed]="!isOpen()">
    <!-- Navigation items -->
    <mat-nav-list class="nav-items">
      @for (item of navItems; track item.label) {
        <a
          mat-list-item
          (click)="onNavItemClick(item)"
          (keyup.enter)="onNavItemClick(item)"
          [class.active]="item.route && router.url.includes(item.route)"
          class="nav-item"
          tabindex="0"
          role="button"
          [attr.data-testid]="'side-nav-' + item.label.toLowerCase()">
          <mat-icon matListItemIcon>{{ item.icon }}</mat-icon>
          <span matListItemTitle>{{ item.label }}</span>
        </a>
      }
    </mat-nav-list>

    <!-- Projects section -->
    @if (projectItems.length > 0) {
      <div class="projects-section">
        <div class="section-header">
          <mat-icon>collections_bookmark</mat-icon>
          <span>Projects</span>
        </div>
        <div class="project-tiles">
          @for (item of projectItems; track item.project.id) {
            <div
              class="project-tile"
              (click)="onProjectClick(item.project)"
              (keyup.enter)="onProjectClick(item.project)"
              [class.selected]="selectedProject?.id === item.project.id"
              tabindex="0"
              role="button"
              [attr.data-testid]="'project-' + item.project.slug"
              [title]="item.project.title">
              <div class="tile-cover">
                <app-project-cover
                  [project]="item.project"
                  variant="small"></app-project-cover>
                @if (item.isShared) {
                  <div
                    class="shared-indicator"
                    [matTooltip]="'Shared by ' + item.sharedByUsername">
                    <mat-icon>group</mat-icon>
                  </div>
                }
                <!-- Sync overlay: shows when project is in sync queue -->
                @if (getSyncStatus(item.project)) {
                  <div
                    class="sync-overlay"
                    [class.syncing]="isSyncing(item.project)"
                    [class.queued]="isQueued(item.project)"
                    [class.synced]="isSynced(item.project)"
                    [class.failed]="hasFailed(item.project)"
                    data-testid="tile-sync-overlay">
                    @if (isSyncing(item.project)) {
                      <mat-spinner diameter="14" strokeWidth="2"></mat-spinner>
                    } @else if (isQueued(item.project)) {
                      <mat-icon class="sync-icon queued-icon"
                        >schedule</mat-icon
                      >
                    } @else if (isSynced(item.project)) {
                      <mat-icon class="sync-icon success-icon"
                        >check_circle</mat-icon
                      >
                    } @else if (hasFailed(item.project)) {
                      <mat-icon class="sync-icon error-icon">error</mat-icon>
                    }
                  </div>
                }
              </div>
              <div class="tile-info">
                <span class="tile-title">{{ item.project.title }}</span>
                <span class="tile-author">{{ item.project.username }}</span>
              </div>
            </div>
          }
        </div>
      </div>
    }
  </nav>
</div>
