<!-- Only render when editor exists -->
@if (editor) {
  <div class="editor-with-panel" [class.panel-open]="showMetaPanel()">
    <!-- Main editor section -->
    <div class="editor-section" [class.no-tabs]="tabsDisabled">
      <!-- Only show toolbar when not in zen mode -->
      @if (!zenMode) {
        <app-editor-toolbar
          [editor]="editor"
          [elementId]="documentId"
          [elementName]="elementName()"
          [metaPanelOpen]="showMetaPanel()"
          (metaPanelToggle)="showMetaPanel.set(!showMetaPanel())"
          (tagsClick)="openTagsDialog()"
          (snapshotsClick)="openSnapshotsDialog()">
        </app-editor-toolbar>
      }
      <div
        class="editor-container fit-width"
        [class.zen-mode-container]="zenMode">
        <div class="scaled-content">
          <div class="editor-wrapper">
            @if (editorKey > 0) {
              <ngx-editor
                [editor]="editor"
                [placeholder]="'Type here...'"
                class="editor-content">
              </ngx-editor>
              <!-- Custom floating menus positioned relative to viewport -->
              @if (isCursorInLintSuggestion()) {
                <app-lint-floating-menu
                  [editor]="editor"></app-lint-floating-menu>
              } @else {
                <app-editor-floating-menu
                  [editor]="editor"></app-editor-floating-menu>
              }
            }
          </div>
        </div>
      </div>
      <!-- Status bar showing word count and sync status -->
      @if (!zenMode) {
        <div class="editor-status-bar">
          <span>Words: {{ wordCount() }}</span>
          <span class="sync-status">
            <span class="sync-dot {{ syncState() }}"></span>
            {{ syncState() }}
          </span>
        </div>
      }
    </div>

    <!-- Meta Panel (Relationships + Snapshots) - at same level as editor section -->
    <div class="meta-panel-container" [class.open]="showMetaPanel()">
      <app-meta-panel
        [documentId]="documentId"
        [elementId]="null"
        [isOpen]="showMetaPanel()"
        (openChange)="showMetaPanel.set($event)">
      </app-meta-panel>
    </div>
  </div>

  <!-- Element Reference Popup (@ mentions) -->
  @if (elementRefService.isPopupOpen()) {
    <app-element-ref-popup
      [position]="elementRefService.popupPosition()!"
      [initialQuery]="elementRefService.searchQuery()"
      (selected)="onElementSelected($event)"
      (closed)="elementRefService.closePopup()">
    </app-element-ref-popup>
  }

  <!-- Element Reference Context Menu (right-click / long-press) -->
  <app-element-ref-context-menu
    [contextData]="contextMenuData()"
    (action)="onContextMenuAction($event)">
  </app-element-ref-context-menu>

  <!-- Element Reference Tooltip (hover) -->
  <app-element-ref-tooltip [tooltipData]="tooltipData()">
  </app-element-ref-tooltip>
}
