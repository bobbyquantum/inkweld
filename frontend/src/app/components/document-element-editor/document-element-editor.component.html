<!-- Only render when editor exists -->
@if (editor) {
  <div class="editor-with-panel">
    <!-- Main editor section -->
    <div class="editor-section" [class.no-tabs]="tabsDisabled">
      <!-- Find in document bar (Ctrl/Cmd + F) -->
      @if (findService.isOpen()) {
        <app-find-in-document></app-find-in-document>
      }
      <!-- Only show toolbar when not in zen mode -->
      @if (!zenMode) {
        <app-editor-toolbar
          [editor]="editor"
          [elementId]="documentId"
          [elementName]="elementName()"
          [disabled]="!projectState.canWrite()"
          (tagsClick)="openTagsDialog()"
          (snapshotsClick)="openSnapshotsDialog()"
          (insertImageClick)="openInsertImageDialog()">
        </app-editor-toolbar>
      }
      <div
        class="editor-container fit-width"
        [class.zen-mode-container]="zenMode">
        <div class="scaled-content">
          <div class="editor-wrapper">
            @if (editorKey > 0) {
              <ngx-editor
                [editor]="editor"
                [placeholder]="'Type here...'"
                class="editor-content">
              </ngx-editor>
              <!-- Custom floating menus positioned relative to viewport -->
              @if (isCursorInLintSuggestion()) {
                <app-lint-floating-menu
                  [editor]="editor"></app-lint-floating-menu>
              } @else {
                <app-editor-floating-menu
                  [editor]="editor"></app-editor-floating-menu>
              }
            }
          </div>
        </div>
      </div>
      <!-- Status bar showing word count, reading time and sync status -->
      @if (!zenMode) {
        <div class="editor-status-bar">
          <span class="status-stats">
            <span>{{ wordCountFormatted() }} words</span>
            @if (readingTime()) {
              <span class="reading-time">Â· {{ readingTime() }}</span>
            }
          </span>
          <span class="sync-status">
            <span class="sync-dot {{ syncState() }}"></span>
            {{ syncState() }}
          </span>
        </div>
      }
    </div>

    <!-- Meta Panel (Relationships) - always visible, manages its own collapsed/expanded state -->
    @if (!zenMode) {
      <div class="meta-panel-container">
        <app-meta-panel
          [documentId]="documentId"
          [elementId]="null"
          [isOpen]="true">
        </app-meta-panel>
      </div>
    }
  </div>

  <!-- Element Reference Popup (@ mentions) -->
  @if (elementRefService.isPopupOpen()) {
    <app-element-ref-popup
      [position]="elementRefService.popupPosition()!"
      [initialQuery]="elementRefService.searchQuery()"
      (selected)="onElementSelected($event)"
      (closed)="elementRefService.closePopup()">
    </app-element-ref-popup>
  }

  <!-- Element Reference Context Menu (right-click / long-press) -->
  <app-element-ref-context-menu
    [contextData]="contextMenuData()"
    (action)="onContextMenuAction($event)">
  </app-element-ref-context-menu>

  <!-- Element Reference Tooltip (hover) -->
  <app-element-ref-tooltip [tooltipData]="tooltipData()">
  </app-element-ref-tooltip>
}
