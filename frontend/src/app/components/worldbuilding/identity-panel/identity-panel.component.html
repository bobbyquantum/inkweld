<aside class="identity-panel" [class.collapsed]="!isExpanded()">
  <!-- Collapse toggle for mobile -->
  <button
    class="collapse-toggle"
    mat-icon-button
    (click)="toggleExpanded()"
    [matTooltip]="isExpanded() ? 'Collapse' : 'Expand'">
    <mat-icon>{{ isExpanded() ? 'expand_less' : 'expand_more' }}</mat-icon>
  </button>

  @if (isExpanded()) {
    <div class="identity-content">
      <!-- Name section -->
      <div class="name-section">
        <span class="element-name">{{ elementName() }}</span>
        @if (canWrite()) {
          <button
            mat-icon-button
            class="rename-button"
            (click)="onRenameClick()"
            matTooltip="Rename">
            <mat-icon>edit</mat-icon>
          </button>
        }
      </div>

      <!-- Image section -->
      <div class="image-section">
        <button
          class="image-placeholder"
          [class.no-image]="!resolvedImageUrl() && !isLoadingImage()"
          (click)="canWrite() ? onImageClick() : viewImage()"
          [matTooltip]="
            canWrite() ? 'Click to set image' : 'Click to view image'
          ">
          @if (isLoadingImage()) {
            <mat-icon class="placeholder-icon spinning"
              >hourglass_empty</mat-icon
            >
            <span class="placeholder-text">Loading...</span>
          } @else if (resolvedImageUrl()) {
            <img [src]="resolvedImageUrl()" [alt]="elementName()" />
          } @else {
            <mat-icon class="placeholder-icon">image</mat-icon>
            <span class="placeholder-text">Add Image</span>
          }
        </button>
        @if (resolvedImageUrl()) {
          <button
            mat-icon-button
            class="view-image-button"
            (click)="viewImage(); $event.stopPropagation()"
            matTooltip="View full size">
            <mat-icon>visibility</mat-icon>
          </button>
        }
      </div>

      <!-- Description section -->
      <div class="description-section">
        <mat-form-field appearance="outline" class="description-field">
          <mat-label>Description</mat-label>
          <textarea
            matInput
            [ngModel]="description()"
            (ngModelChange)="onDescriptionChange($event)"
            placeholder="Brief description (shown in tooltips)"
            rows="4"
            cdkTextareaAutosize
            [readonly]="!canWrite()"></textarea>
          <mat-hint>Used for tooltips and previews</mat-hint>
        </mat-form-field>
      </div>

      <!-- Tags section -->
      <div class="tags-section">
        <app-tag-chip-list
          [elementId]="elementId()"
          label="Tags"
          hint="Organize with tags"
          [compact]="true"
          [readonly]="!canWrite()">
        </app-tag-chip-list>
      </div>
    </div>
  } @else {
    <!-- Collapsed view - just show image thumbnail -->
    <div class="collapsed-content">
      @if (resolvedImageUrl()) {
        <img
          class="thumbnail"
          [src]="resolvedImageUrl()"
          [alt]="elementName()" />
      } @else {
        <mat-icon class="thumbnail-placeholder">image</mat-icon>
      }
      <span class="collapsed-name">{{ elementName() }}</span>
    </div>
  }
</aside>
