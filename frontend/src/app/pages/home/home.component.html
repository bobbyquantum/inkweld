<div class="content-container" [class.is-mobile]="isMobile">
  @if (isLoading()) {
    <div class="loading-state">
      <mat-spinner diameter="40" />
      <p>Loading projects...</p>
    </div>
  } @else if (loadError) {
    <div class="error-state">
      <mat-icon class="error-icon">error_outline</mat-icon>
      <h2>Failed to load projects</h2>
      <p>There was a problem connecting to the server</p>
      <button mat-raised-button color="primary" (click)="loadProjects()">
        <mat-icon>refresh</mat-icon>
        Retry
      </button>
    </div>
  } @else if (filteredProjects().length === 0 && !searchControl.value) {
    <div class="empty-state">
      <mat-icon class="empty-icon">add_circle_outline</mat-icon>
      <h2>Create Your First Project</h2>
      <p>Get started by creating a new project</p>
      <button mat-button (click)="openNewProjectDialog()">
        Create Project
      </button>
    </div>
  } @else {
    <div class="search-container">
      <mat-form-field appearance="outline" class="custom-search-field">
        <input
          matInput
          placeholder="Search projects"
          [formControl]="searchControl" />
        <mat-icon matPrefix>search</mat-icon>
        @if (searchControl.value) {
          <button
            matSuffix
            mat-icon-button
            aria-label="Clear"
            (click)="searchControl.setValue('')">
            <mat-icon>close</mat-icon>
          </button>
        }
      </mat-form-field>
    </div>

    @if (filteredProjects().length === 0 && searchControl.value) {
      <div class="empty-search-results">
        <mat-icon>search_off</mat-icon>
        <h3>No projects found</h3>
        <p>Try a different search term</p>
      </div>
    } @else {
      <div class="projects-grid">
        @for (project of filteredProjects(); track project.slug) {
          <div
            (click)="selectProject(project)"
            (keyup.enter)="selectProject(project)"
            tabindex="0"
            role="button"
            class="project-card-wrapper"
            title="Select {{ project.title }}">
            <app-project-card [project]="project" />
          </div>
        }
      </div>
    }
  }
</div>

@if (projectService.projects().length > 0) {
  <button
    mat-fab
    extended
    color="accent"
    class="add-project-fab"
    (click)="openNewProjectDialog()"
    aria-label="Add new project">
    <mat-icon>add</mat-icon>
    New Project
  </button>
}

<!-- Add user menu FAB -->
<button mat-fab class="user-menu-fab" aria-label="User menu">
  <app-user-menu [user]="userService.currentUser()" [miniMode]="false" />
</button>
