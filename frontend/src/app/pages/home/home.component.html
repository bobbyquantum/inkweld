<div class="content-container" [class.is-mobile]="isMobile">
  <!-- Header section with logo and search bar (always visible) -->
  <div class="header-section">
    <div class="search-container">
      <img class="app-logo" src="/logo.png" alt="InkWeld logo" />

      @if (isAuthenticated()) {
        <mat-form-field
          appearance="outline"
          density="compact"
          class="custom-search-field"
          hideRequiredMarker="true"
          subscriptSizing="dynamic">
          <input
            matInput
            placeholder="Search projects"
            [formControl]="searchControl" />
          <mat-icon matPrefix>search</mat-icon>
          @if (searchControl.value) {
            <button
              matSuffix
              mat-icon-button
              aria-label="Clear"
              (click)="searchControl.setValue('')">
              <mat-icon>close</mat-icon>
            </button>
          }
        </mat-form-field>
      }

      <!-- Show user menu if authenticated, otherwise show login/register buttons -->
      @if (isAuthenticated()) {
        <app-user-menu
          [user]="userService.currentUser()"
          [miniMode]="true"></app-user-menu>
      } @else {
        <div class="auth-buttons">
          <button
            mat-stroked-button
            color="primary"
            (click)="navigateToLogin()"
            class="login-btn">
            Login
          </button>
          <button
            mat-raised-button
            color="primary"
            (click)="navigateToRegister()"
            class="register-btn">
            Register
          </button>
        </div>
      }
    </div>
  </div>

  <!-- Main content section -->
  @if (!isAuthenticated()) {
    <!-- Content for unauthenticated users -->
    <div class="welcome-content">
      <div class="hero-section">
        <h1>Welcome to InkWeld</h1>
        <p class="hero-description">
          InkWeld is a collaborative writing platform designed for anyone who
          wants to write. Organize your projects, collaborate with others, and
          bring your stories to life.
        </p>
      </div>

      <div class="features-section">
        <div class="feature-grid">
          <div class="feature-card">
            <mat-icon class="feature-icon">edit_note</mat-icon>
            <h3>Write & Organize</h3>
            <p>
              Organize your manuscripts, scripts, and creative projects with
              intuitive folder structures and document management.
            </p>
          </div>

          <div class="feature-card">
            <mat-icon class="feature-icon">group</mat-icon>
            <h3>Collaborate</h3>
            <p>
              Work together with co-authors, editors, and beta readers. Share
              projects and get feedback in real-time.
            </p>
          </div>

          <div class="feature-card">
            <mat-icon class="feature-icon">history</mat-icon>
            <h3>Version Control</h3>
            <p>
              Track changes, manage revisions, and never lose your work with
              built-in version control for writers.
            </p>
          </div>

          <div class="feature-card">
            <mat-icon class="feature-icon">publish</mat-icon>
            <h3>Share & Publish</h3>
            <p>
              Export your work in multiple formats and share your projects with
              the community.
            </p>
          </div>
        </div>
      </div>

      <div class="cta-section">
        <h2>Ready to start writing?</h2>
        <p>
          Please note this is a development version of InkWeld. Some features
          may not be available. Data may be erased without warning.
        </p>
        <div class="cta-buttons">
          <button
            mat-raised-button
            color="primary"
            size="large"
            (click)="navigateToRegister()"
            class="cta-register">
            Get Started
          </button>
          <button
            mat-stroked-button
            color="primary"
            size="large"
            (click)="navigateToLogin()"
            class="cta-login">
            Sign In
          </button>
        </div>
      </div>
    </div>
  } @else {
    <!-- Content for authenticated users (existing project management) -->
    @if (isLoading()) {
      <div class="loading-state">
        <mat-spinner diameter="40" />
        <p>Loading projects...</p>
      </div>
    } @else if (loadError) {
      <div class="error-state">
        <mat-icon class="error-icon">error_outline</mat-icon>
        <h2>Failed to load projects</h2>
        <p>There was a problem connecting to the server</p>
        <button mat-raised-button color="primary" (click)="loadProjects()">
          <mat-icon>refresh</mat-icon>
          Retry
        </button>
      </div>
    } @else if (filteredProjects().length === 0 && !searchControl.value) {
      <div class="empty-state">
        <mat-icon class="empty-icon">add_circle_outline</mat-icon>
        <h2>Create Your First Project</h2>
        <p>Get started by creating a new project</p>
        <button mat-button (click)="openNewProjectDialog()">
          Create Project
        </button>
      </div>
    } @else {
      @if (filteredProjects().length === 0 && searchControl.value) {
        <div class="empty-search-results">
          <mat-icon>search_off</mat-icon>
          <h3>No projects found</h3>
          <p>Try a different search term</p>
        </div>
      } @else {
        <app-bookshelf
          [projects]="filteredProjects()"
          (projectSelected)="selectProject($event)">
        </app-bookshelf>
      }
    }
  }
</div>

<!-- FAB for creating new projects (only for authenticated users) -->
@if (isAuthenticated() && projectService.projects().length > 0) {
  <button
    mat-fab
    extended
    color="accent"
    class="add-project-fab"
    (click)="openNewProjectDialog()"
    aria-label="Add new project">
    <mat-icon>add</mat-icon>
    New Project
  </button>
}
