<div class="register-container" [class.mobile]="isMobile">
  <div class="content-wrapper">
    <mat-card>
      <div class="logo-container">
        <img src="/logo.png" alt="Inkweld Logo" class="logo-image" />
      </div>

      <div class="card-content">
        <h2 class="title">Register for Inkweld</h2>

        <form [formGroup]="registerForm" (ngSubmit)="onRegister()">
          <mat-form-field appearance="outline">
            <mat-label>Username</mat-label>
            <input
              matInput
              type="text"
              formControlName="username"
              required
              (blur)="checkUsernameAvailability()"
              aria-label="Username" />
            <mat-icon matSuffix>
              @switch (usernameAvailability) {
                @case ('available') {
                  <mat-icon color="primary">check_circle</mat-icon>
                }
                @case ('unavailable') {
                  <mat-icon color="warn">cancel</mat-icon>
                }
              }
            </mat-icon>
            <mat-error>{{ getUsernameErrorMessage() }}</mat-error>
          </mat-form-field>

          @if (usernameSuggestions && usernameSuggestions.length > 0) {
            <div class="username-suggestions">
              <span class="suggestions-label">Available alternatives:</span>
              <div class="suggestions-buttons">
                @for (suggestion of usernameSuggestions; track suggestion) {
                  <button
                    mat-stroked-button
                    color="primary"
                    type="button"
                    (click)="selectSuggestion(suggestion)"
                    class="suggestion-button">
                    {{ suggestion }}
                  </button>
                }
              </div>
            </div>
          }

          <mat-form-field appearance="outline">
            <mat-label>Password</mat-label>
            <input
              matInput
              type="password"
              formControlName="password"
              required
              aria-label="Password" />
            <mat-error>{{ getPasswordErrorMessage() }}</mat-error>
          </mat-form-field>

          @if (
            serverValidationErrors['password'] &&
            serverValidationErrors['password'].length > 0
          ) {
            <div class="password-validation-errors">
              <div class="validation-error-heading">Password requirements:</div>
              <ul class="validation-error-list">
                @for (
                  error of serverValidationErrors['password'];
                  track error
                ) {
                  <li class="validation-error-item">
                    <mat-icon class="validation-error-icon">
                      error_outline
                    </mat-icon>
                    <span>{{ error }}</span>
                  </li>
                }
              </ul>
            </div>
          }

          <mat-form-field appearance="outline">
            <mat-label>Confirm Password</mat-label>
            <input
              matInput
              type="password"
              formControlName="confirmPassword"
              required
              aria-label="Confirm Password" />
            <mat-error>{{ getConfirmPasswordErrorMessage() }}</mat-error>
          </mat-form-field>

          <button
            mat-raised-button
            color="primary"
            type="submit"
            [disabled]="registerForm.invalid || isRegistering"
            class="register-button">
            @if (!isRegistering) {
              <span>Register</span>
            }
            @if (isRegistering) {
              <span>Registering...</span>
            }
          </button>
        </form>

        <mat-divider></mat-divider>

        <div class="oauth-container">
          <app-oauth-provider-list
            [isRegisterContext]="true"></app-oauth-provider-list>
        </div>

        <button
          mat-raised-button
          color="primary"
          type="button"
          routerLink="/welcome"
          class="login-button">
          Already have an account? Login here
        </button>
      </div>
    </mat-card>
  </div>
</div>
