@if (projectState.isLoading()) {
  <div class="loading-indicator">
    <mat-spinner diameter="40"></mat-spinner>
  </div>
}

<!-- Zen mode overlay -->
@if (isZenMode()) {
  <div class="zen-mode-overlay">
    <div class="zen-mode-editor-container">
      <button
        mat-icon-button
        class="zen-mode-close-button"
        (click)="toggleZenMode()">
        <mat-icon>close</mat-icon>
      </button>
      @if (getCurrentDocumentId()) {
        <app-document-element-editor
          [documentId]="getCurrentDocumentId()!"
          [tabsDisabled]="!useTabsDesktop()"
          [zenMode]="true">
        </app-document-element-editor>
      }
    </div>
  </div>
}

<mat-sidenav-container class="main-container">
  <!-- Mobile sidenav -->
  @if (isMobile()) {
    <mat-sidenav
      mode="over"
      [opened]="false"
      class="sidenav-content mobile-sidenav">
      <app-project-tree
        (documentOpened)="onDocumentOpened($event)"></app-project-tree>
    </mat-sidenav>
  }
  <mat-sidenav-content>
    <!-- Main toolbar -->
    <mat-toolbar class="mobile-toolbar">
      <button mat-icon-button (click)="toggleSidebar()">
        <mat-icon>menu</mat-icon>
      </button>
      <span class="project-title">{{ projectState.project()?.title }}</span>
      <span class="toolbar-spacer"></span>
      <div class="toolbar-actions">
        <button
          mat-icon-button
          [matMenuTriggerFor]="moreMenuMobile"
          class="action-button">
          <mat-icon>more_vert</mat-icon>
        </button>
        <app-user-menu [miniMode]="true" class="action-button"></app-user-menu>
      </div>
      <mat-menu #moreMenuMobile="matMenu">
        @if (canEnableZenMode() || isZenMode()) {
          <button mat-menu-item (click)="toggleZenMode()">
            <mat-icon>{{ getZenModeIcon() }}</mat-icon>
            <span>Toggle Zen Mode</span>
          </button>
        }
        <button mat-menu-item (click)="onPublishClick()">
          <mat-icon>publish</mat-icon>
          <span>Publish project</span>
        </button>
        <button mat-menu-item (click)="onShowDocumentList()">
          <mat-icon>description</mat-icon>
          <span>Show Document List</span>
        </button>
        <button mat-menu-item (click)="onShowFileList()">
          <mat-icon>folder</mat-icon>
          <span>Show File List</span>
        </button>
        <button mat-menu-item (click)="exitProject()">
          <mat-icon>exit_to_app</mat-icon>
          <span>Exit project</span>
        </button>
      </mat-menu>
    </mat-toolbar>

    @if (isMobile()) {
      <div class="mobile-content-wrapper">
        <!-- Content area only (tabs removed since we now use sidenav navigation) -->
        <div class="content-area">
          <router-outlet></router-outlet>
        </div>
      </div>
    } @else {
      @if (showSidebar()) {
        <!-- Desktop split layout -->
        <as-split
          direction="horizontal"
          [gutterSize]="getGutterSize()"
          unit="percent"
          [useTransition]="true"
          (dragEnd)="onSplitDragEnd($event)">
          <!-- Custom gutter template -->
          <div
            *asSplitGutter="let isDragged = isDragged"
            class="inkweld-gutter"
            [class.dragging]="isDragged">
            <div class="inkweld-gutter-icon"></div>
          </div>
          <!-- Sidebar area -->
          <as-split-area [size]="splitSize" [minSize]="15" [maxSize]="40">
            <div class="sidebar-area">
              <mat-toolbar class="project-toolbar">
                <button mat-icon-button (click)="exitProject()">
                  <mat-icon>arrow_back</mat-icon>
                </button>
                <span class="project-title">{{
                  projectState.project()?.title
                }}</span>
                <button
                  mat-icon-button
                  (click)="projectState.showNewElementDialog()">
                  <mat-icon>add</mat-icon>
                </button>
              </mat-toolbar>
              <app-project-tree
                (documentOpened)="onDocumentOpened($event)"></app-project-tree>
            </div>
          </as-split-area>
          <!-- Content area -->
          <as-split-area>
            <div class="desktop-content">
              @if (useTabsDesktop()) {
                <div class="tabs-header">
                  <app-tab-interface
                    (importRequested)="onImportClicked()"></app-tab-interface>
                </div>
              }
              <div class="content-area">
                <router-outlet></router-outlet>
              </div>
            </div>
          </as-split-area>
        </as-split>
      } @else {
        <!-- Desktop full-width content -->
        <div class="desktop-content">
          @if (useTabsDesktop()) {
            <div class="tabs-header">
              <app-tab-interface
                (importRequested)="onImportClicked()"></app-tab-interface>
            </div>
          }
          <div class="content-area">
            <router-outlet></router-outlet>
          </div>
        </div>
      }
    }

    <!-- Hidden file input for import -->
    <input
      type="file"
      #fileInput
      style="display: none"
      accept=".zip"
      (change)="onFileSelected($event)" />
  </mat-sidenav-content>
</mat-sidenav-container>
