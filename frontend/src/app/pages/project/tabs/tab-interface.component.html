<div class="tab-interface-container">
  <nav
    mat-tab-nav-bar
    [mat-stretch-tabs]="false"
    [tabPanel]="tabPanel"
    class="tab-nav-bar">
    <!-- Home Tab -->
    <a
      mat-tab-link
      [active]="currentTabIndex === 0"
      (click)="onTabChange(0)"
      (keydown.enter)="onTabChange(0)"
      (keydown.space)="onTabChange(0)"
      tabindex="0">
      <div class="tab-label home-tab">
        <mat-icon>home</mat-icon>
      </div>
    </a>

    <!-- Document Tabs -->
    @for (
      document of projectState.openDocuments();
      track document.id;
      let i = $index
    ) {
      <a
        mat-tab-link
        [active]="currentTabIndex === i + 1"
        (click)="onTabChange(i + 1)"
        (keydown.enter)="onTabChange(i + 1)"
        (keydown.space)="onTabChange(i + 1)"
        [cdkContextMenuTriggerFor]="tabContextMenu"
        (contextmenu)="onTabContextMenu(i + 1, document)"
        [style.--mdc-tab-indicator-active-indicator-color]="
          document.type !== 'FOLDER'
            ? getSyncStatusColor(
                projectState.project()?.username,
                projectState.project()?.slug,
                document.id
              )
            : 'var(--mat-sys-primary-color)'
        "
        tabindex="0">
        <div class="tab-label">
          <span class="tab-name">{{ document.name }}</span>
          <button
            mat-icon-button
            class="close-tab-button"
            (click)="closeTab(i + 1, $event)">
            <mat-icon>close</mat-icon>
          </button>
        </div>
      </a>
    }
  </nav>

  <mat-tab-nav-panel #tabPanel></mat-tab-nav-panel>
</div>

<!-- Tab Context Menu -->
<ng-template #tabContextMenu>
  <div class="tab-context-menu" cdkMenu>
    <!-- Only show rename for document tabs (not for home tab) -->
    @if (contextDocument) {
      <button
        type="button"
        class="context-menu-item"
        cdkMenuItem
        (click)="onRenameTabElement(contextDocument)">
        <mat-icon>edit_square</mat-icon>
        <span class="context-menu-item-title">Rename</span>
      </button>
      <button
        type="button"
        class="context-menu-item"
        cdkMenuItem
        (click)="closeTab(contextTabIndex || 0)">
        <mat-icon>close</mat-icon>
        <span class="context-menu-item-title">Close</span>
      </button>
    }
  </div>
</ng-template>
