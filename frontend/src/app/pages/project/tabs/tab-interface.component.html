<div class="tab-bar-container">
  <!-- Left scroll arrow -->
  @if (canScrollLeft()) {
    <button
      type="button"
      class="scroll-arrow scroll-arrow-left"
      (click)="scrollLeft()"
      aria-label="Scroll tabs left">
      <mat-icon>chevron_left</mat-icon>
    </button>
  }

  <div class="tabs-scroll-container" ngTabs>
    <nav
      #tabNavBar
      ngTabList
      cdkDropList
      cdkDropListOrientation="horizontal"
      (cdkDropListDropped)="onTabDrop($event)"
      class="tab-nav-bar"
      [selectedTab]="'tab-' + currentTabIndex"
      selectionMode="explicit"
      (scroll)="onTabsScroll()">
      <!-- All Tabs (including Home) -->
      @for (tab of projectState.openTabs(); track tab.id; let i = $index) {
        <button
          cdkDrag
          ngTab
          [value]="'tab-' + i"
          type="button"
          (click)="onTabChange(i)"
          [cdkContextMenuTriggerFor]="tabContextMenu"
          (contextmenu)="onTabContextMenu(i, tab)"
          [attr.data-testid]="
            tab.systemType === 'home' ? 'home-tab-button' : 'tab-' + tab.name
          "
          class="tab-button"
          [class.home-tab]="tab.systemType === 'home'">
          <mat-icon class="tab-icon">{{ getTabIcon(tab) }}</mat-icon>
          <span class="tab-name">{{ tab.name }}</span>
          <button
            type="button"
            class="close-tab-button"
            (click)="closeTab(i, $event)">
            <mat-icon>close</mat-icon>
          </button>
        </button>
      }
    </nav>
  </div>

  <!-- Right scroll arrow -->
  @if (canScrollRight()) {
    <button
      type="button"
      class="scroll-arrow scroll-arrow-right"
      (click)="scrollRight()"
      aria-label="Scroll tabs right">
      <mat-icon>chevron_right</mat-icon>
    </button>
  }

  <!-- Fixed end actions (projected content) -->
  <div class="tab-bar-actions">
    <ng-content></ng-content>
  </div>
</div>

<!-- Tab Context Menu -->
<ng-template #tabContextMenu>
  <div class="tab-context-menu" cdkMenu>
    <!-- Only show rename for document/folder tabs (not for system tabs) and users with write access -->
    @if (
      contextTab && contextTab.type !== 'system' && projectState.canWrite()
    ) {
      <button
        type="button"
        class="context-menu-item"
        cdkMenuItem
        (click)="onRenameTabElement(contextTab)">
        <mat-icon>edit_square</mat-icon>
        <span class="context-menu-item-title">Rename</span>
      </button>
    }
    @if (contextTab) {
      <button
        type="button"
        class="context-menu-item"
        cdkMenuItem
        (click)="closeTab(contextTabIndex || 0)">
        <mat-icon>close</mat-icon>
        <span class="context-menu-item-title">Close</span>
      </button>
      @if (hasTabsToRight()) {
        <button
          type="button"
          class="context-menu-item"
          cdkMenuItem
          (click)="closeTabsToRight()">
          <mat-icon>chevron_right</mat-icon>
          <span class="context-menu-item-title">Close to the Right</span>
        </button>
      }
      @if (hasOtherTabs()) {
        <button
          type="button"
          class="context-menu-item"
          cdkMenuItem
          (click)="closeOtherTabs()">
          <mat-icon>tab_unselected</mat-icon>
          <span class="context-menu-item-title">Close Others</span>
        </button>
      }
      <button
        type="button"
        class="context-menu-item"
        cdkMenuItem
        (click)="closeAllTabs()">
        <mat-icon>close_fullscreen</mat-icon>
        <span class="context-menu-item-title">Close All</span>
      </button>
    }
  </div>
</ng-template>
