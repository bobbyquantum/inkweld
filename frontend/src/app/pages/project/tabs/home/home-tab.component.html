<div class="home-tab-content">
  <div class="full-width-column">
    <div class="full-width-header">
      <div class="header-content">
        <div class="cover-image-wrapper">
          <app-project-cover
            [project]="projectState.project()!"
            variant="list"></app-project-cover>
        </div>
        <div class="project-info">
          <h2>{{ projectState.project()?.title }}</h2>
          <p>{{ projectState.project()?.description }}</p>
        </div>
        <button mat-icon-button (click)="projectState.showEditProjectDialog()">
          <mat-icon>edit</mat-icon>
        </button>
      </div>
    </div>
  </div>

  <div class="columns-container">
    <div class="home-column">
      <div class="home-column-header">
        <h3>Start</h3>
      </div>

      <div class="start-actions">
        <button mat-button color="primary" (click)="onNewFileClick()">
          <mat-icon>note_add</mat-icon>
          New File
        </button>
        <button mat-button color="primary" (click)="onGenerateCoverClick()">
          <mat-icon>image</mat-icon>
          Generate Cover
        </button>
        <button mat-button color="primary" (click)="onExportClick()">
          <mat-icon>cloud_download</mat-icon>
          Export Project
        </button>
        <button mat-button color="primary" (click)="onImportClick()">
          <mat-icon>cloud_upload</mat-icon>
          Import Project
        </button>
        <button mat-button color="primary" (click)="onPublishClick()">
          <mat-icon>cloud_upload</mat-icon>
          Publish Project
        </button>
        <button mat-button color="primary" (click)="openDocumentsTab()">
          <mat-icon>list</mat-icon>
          Project Documents
        </button>
        <button
          mat-button
          color="primary"
          (click)="openTemplatesTab()"
          data-testid="template-library-button">
          <mat-icon>description</mat-icon>
          Templates
        </button>
      </div>
    </div>
    <div class="home-column">
      <div class="home-column-header">
        <h3>Recent Elements</h3>
      </div>
      @if (
        projectState.project() &&
        recentFilesService.getRecentFilesForProject(
          projectState.project()!.username!,
          projectState.project()!.slug!
        ).length > 0
      ) {
        <div class="recent-files-list">
          @for (
            document of recentFilesService.getRecentFilesForProject(
              projectState.project()!.username!,
              projectState.project()!.slug!
            );
            track document.id
          ) {
            <div
              tabindex="0"
              class="recent-file-item"
              role="button"
              (keydown)="onRecentDocumentKeydown($event, document.id)"
              (click)="onRecentDocumentClick(document.id)">
              <mat-icon>{{
                document.type === 'IMAGE' ? 'image' : 'description'
              }}</mat-icon>
              <span class="recent-file-name">{{ document.name }}</span>
            </div>
          }
        </div>
      } @else {
        <p class="no-recent-files">
          <mat-icon>info</mat-icon>
          No recent elements yet. Open documents to see them here.
        </p>
      }
    </div>

    <div class="home-column">
      <div class="home-column-header">
        <h3>Publish Plans</h3>
        <button
          mat-icon-button
          (click)="createPublishPlan()"
          aria-label="Create new publish plan"
          data-testid="create-publish-plan-button">
          <mat-icon>add</mat-icon>
        </button>
      </div>
      @if (projectState.publishPlans().length > 0) {
        <div class="publish-plans-list" data-testid="publish-plans-list">
          @for (plan of projectState.publishPlans(); track plan.id) {
            <div class="publish-plan-item" data-testid="publish-plan-item">
              <div
                tabindex="0"
                class="plan-content"
                role="button"
                (keydown)="onPublishPlanKeydown($event, plan)"
                (click)="openPublishPlan(plan)">
                <mat-icon>menu_book</mat-icon>
                <div class="plan-info">
                  <span class="plan-name">{{ plan.name }}</span>
                  <span class="plan-format">{{ plan.format }}</span>
                </div>
              </div>
              <button
                mat-icon-button
                class="delete-plan-btn"
                (click)="deletePublishPlan($event, plan)"
                (keydown)="onDeletePublishPlanKeydown($event, plan)"
                [attr.aria-label]="'Delete ' + plan.name"
                data-testid="delete-plan-button">
                <mat-icon>delete</mat-icon>
              </button>
            </div>
          }
        </div>
      } @else {
        <p class="no-publish-plans" data-testid="no-publish-plans">
          <mat-icon>info</mat-icon>
          No publish plans yet. Create one to export your project as EPUB or
          PDF.
        </p>
      }
    </div>
  </div>
</div>
